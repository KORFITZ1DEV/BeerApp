@page "/beer"

@using ModelLibrary
@using BusinessLogic
@using BusinessLogic.Interfaces
@using System.Linq.Expressions

@inject IBeerLogic beerl
@inject IBeerGroupLogic groupl
@inject IRatingLogic ratingl
@inject IBeerLoverLogic beerloverl
@inject IBreweryLogic breweryl

<PageTitle>Beer</PageTitle>

<h1>Beer with best ratings</h1>
<div class="flex-row">

    <div class="flex-col">
        @foreach (var beer in _allbeer)
        {
            <div
                style="display: overflow-y: auto; border: 2px solid #3498db; border-radius: 8px; background-color: #ecf023; padding: 20px; margin: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif; text-align: center; line-height: 1.5;">
                <p>@beer.BeerName</p>
                @if (beer.BeerImage != null)
                {
                    <img height="200" width="250" src="data:image/jpeg;base64,@(Convert.ToBase64String(beer.BeerImage))"
                        alt="Beer Image" />
                }
                <p>@beer.BeerType </p>
                <p>@beer.Description </p>
                <p>@beer.LagerSubType</p>
                <p>@beer.Brewery</p>
                <button type="button" @onclick="(e) => DeleteBeer(beer)" class="btn btn-primary">Delete</button>
            </div>
        }
        <div class="flex-col">
            @foreach (var beerLover in _allBeerLovers)
            {
                <div
                    style="display: overflow-y: auto; border: 2px solid #3498db; border-radius: 8px; background-color: #ecb0f1; padding: 20px; margin: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif; text-align: center; line-height: 1.5;">
                    <p>@beerLover.BeerLoverID </p>
                    <p>@beerLover.BeerLoverName </p>
                    <p>@beerLover.BeerLoverEmail </p>
                    <p>@beerLover.BeerGroups </p>
                    <p>@beerLover.Ratings</p>
                    <button type="button" @onclick="(e) => DeleteBeerLover(beerLover)"
                        class="btn btn-danger">Delete</button>
                </div>
            }
        </div>
        <div class="flex-col">
            @foreach (var beergroup in _allGroups)
            {
                <div
                    style="display: overflow-y: auto; border: 2px solid #3498db; border-radius: 8px; background-color: #aaadf1; padding: 20px; margin: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif; text-align: center; line-height: 1.5;">
                    <p>@beergroup.BeerGroupID </p>
                    <p>@beergroup.GroupName</p>
                    <button type="button" @onclick="(e) => DeleteGroup(beergroup)" class="btn btn-danger">Delete</button>
                </div>
            }
        </div>
        <div class="flex-col">
            @foreach (var brewery in _allBreweries)
            {
                <div
                    style="display: overflow-y: auto; border: 2px solid #3498db; border-radius: 8px; background-color: #bff0f1; padding: 20px; margin: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif; text-align: center; line-height: 1.5;">
                    <p>@brewery.BreweryID </p>
                    <p>@brewery.BreweryName</p>
                    <p>@brewery.BreweryAddress</p>
                    <p>@brewery.Country</p>
                    <button type="button" @onclick="(e) => DeleteBrewery(brewery)" class="btn btn-danger">Delete</button>
                </div>
            }
        </div>
        <div class="flex-col">
            @foreach (var rating in _allRatings)
            {
                <div
                    style="display: overflow-y: auto; border: 2px solid #3498db; border-radius: 8px; background-color: #CE3A1A; padding: 20px; margin: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif; text-align: center; line-height: 1.5;">
                    <p>@rating.RatingID</p>
                    <p>@(rating.Beer != null ? rating.Beer.BeerName : "Beer not available")</p>
                    <p>@(rating.Taster != null ? rating.Taster.BeerLoverName : "Unknown")</p>
                    <p>@rating.RatingScore</p>
                    <p>@rating.RatingDate</p>
                    <p>@rating.Review</p>
                    <button type="button" @onclick="(e) => DeleteRating(rating)" class="btn btn-danger">Delete</button>
                </div>
            }
        </div>

    </div>
</div>


@code {

    private readonly List<BeerModel> _allbeer = new();
    readonly List<BeerLoverModel> _allBeerLovers = new();
    readonly List<BeerGroupModel> _allGroups = new();
    readonly List<BreweryModel> _allBreweries = new();
    readonly List<RatingModel> _allRatings = new();

    protected override async Task OnInitializedAsync()
    {
        _allBeerLovers.AddRange(await beerloverl.GetAll());
        _allbeer.AddRange(await beerl.GetAll());
        _allGroups.AddRange(await groupl.GetAll());
        _allBreweries.AddRange(await breweryl.GetAll());
        _allRatings.AddRange(await ratingl.GetAll());
    }

    public async Task DeleteBeer(BeerModel beer)
    {
        await beerl.Delete(beer);
        _allbeer.Remove(beer); // Remove the deleted beer from the list
    }

    public async Task DeleteBeerLover(BeerLoverModel beerLover)
    {
        await beerloverl.Delete(beerLover);
        _allBeerLovers.Remove(beerLover);
    }

    public async Task DeleteGroup(BeerGroupModel group)
    {
        await groupl.Delete(group);
        _allGroups.Remove(group);
    }
    public async Task DeleteBrewery(BreweryModel brewery)
    {
        await breweryl.Delete(brewery);
        _allBreweries.Remove(brewery);
    }

    public async Task DeleteRating(RatingModel rating)
    {
        await ratingl.Delete(rating);
        _allRatings.Remove(rating);
    }

}